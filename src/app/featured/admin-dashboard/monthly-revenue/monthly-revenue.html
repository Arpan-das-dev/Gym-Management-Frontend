<!-- ============================= -->
<!-- ðŸŒ GLOBAL LOADER -->
<!-- ============================= -->
@if (loading) {
  <div
    class="fixed inset-0 z-[99998] flex items-center justify-center
           bg-black/60 backdrop-blur-sm"
  >
    <div class="text-center animate-pulse">
      <fa-icon [icon]="icons.cogs" class="text-5xl text-white mb-3"></fa-icon>
      <p class="text-base font-semibold text-white">
        {{ messageText }}...
      </p>
    </div>
  </div>
}

<!-- ============================= -->
<!-- ðŸŒ GLOBAL TOAST -->
<!-- ============================= -->
@if (showMessage) {
  <div
    class="fixed top-20 left-0 right-0 z-[99999]
           flex justify-center pointer-events-none"
  >
    <div
      class="px-5 py-3 rounded-xl shadow-xl text-white
             pointer-events-auto animate-fadeIn"
      [ngClass]="{
        'bg-green-600': messageType === 'success',
        'bg-red-600': messageType === 'error'
      }"
    >
      <fa-icon
        [icon]="messageType === 'success'
          ? icons.checkCircle
          : icons.exclamationCircle"
        class="mr-2"
      ></fa-icon>

      <span class="font-medium">{{ messageText }}</span>
    </div>
  </div>
}

<!-- ============================= -->
<!-- ðŸ“Š ADMIN REVENUE PAGE -->
<!-- ============================= -->
<div class="min-h-screen bg-slate-50 p-6">

  <!-- ðŸ”™ BACK TO DASHBOARD -->
  <button
    (click)="handleNavigation()"
    class="flex items-center gap-2 text-blue-600 hover:text-blue-700 mb-6"
  >
    <fa-icon [icon]="icons.arrowLeft"></fa-icon>
    Back to Dashboard
  </button>

  <!-- ============================= -->
  <!-- ðŸ’° LIFETIME REVENUE -->
  <!-- ============================= -->
  <div
    class="bg-gradient-to-r from-amber-400 to-orange-500
           text-white rounded-2xl p-6 shadow mb-8"
  >
    <p class="text-sm uppercase opacity-90">Lifetime Revenue</p>
    <h2 class="text-4xl font-bold mt-2">
      â‚¹ {{ lifeTimeIncome | number }}
    </h2>
    <p class="text-xs opacity-80 mt-1">
      All successful payments till date
    </p>
  </div>

  <!-- ============================= -->
  <!-- âš¡ QUICK STATS -->
  <!-- ============================= -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">

    <div class="bg-white rounded-xl p-5 shadow border">
      <p class="text-xs text-slate-500">Today</p>
      <h3 class="text-2xl font-bold text-slate-800">
        â‚¹ {{ quickStats.todayIncome | number }}
      </h3>
    </div>

    <div class="bg-white rounded-xl p-5 shadow border">
      <p class="text-xs text-slate-500">This Month</p>
      <h3 class="text-2xl font-bold text-orange-500">
        â‚¹ {{ quickStats.monthlyIncome | number }}
      </h3>
    </div>

    <div class="bg-white rounded-xl p-5 shadow border">
      <p class="text-xs text-slate-500">This Year</p>
      <h3 class="text-2xl font-bold text-blue-600">
        â‚¹ {{ quickStats.yearlyIncome | number }}
      </h3>
    </div>

  </div>

  <!-- ============================= -->
  <!-- ðŸ“ˆ MONTHLY REVENUE TREND -->
  <!-- ============================= -->
  <div class="bg-white rounded-2xl p-6 shadow border mb-10">

    <div class="flex items-center justify-between mb-4">
      <h2 class="font-semibold text-lg text-slate-800">
        Monthly Revenue Trend
      </h2>

      <select
        [(ngModel)]="selectedYear"
        (change)="loadRevenueTrendByYear()"
        class="border rounded-lg px-3 py-2 text-sm"
      >
        @for (y of yearList; track y) {
          <option [value]="y">{{ y }}</option>
        }
      </select>
    </div>

    <div class="relative h-[320px]">
      <canvas id="revenueChart"></canvas>
    </div>

  </div>

  <!-- ============================= -->
  <!-- ðŸ’¼ REVENUE BY PLAN -->
  <!-- ============================= -->
  <div class="bg-white rounded-2xl p-6 shadow border mb-10">

    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold text-slate-800">
        Revenue by Plan
      </h2>
      <span class="text-xs text-slate-500">
        Sorted by revenue
      </span>
    </div>

    @if (revenuePerPlan.length === 0) {
      <div class="text-center py-10 text-slate-500 text-sm">
        No revenue data available
      </div>
    }

    @if (revenuePerPlan.length > 0) {
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">

          <thead>
            <tr class="text-left text-slate-500 border-b">
              <th class="py-3">Plan</th>
              <th class="py-3">Revenue</th>
              <th class="py-3">Purchases</th>
            </tr>
          </thead>

          <tbody>
            @for (plan of revenuePerPlan; track plan.planName) {
              <tr
                class="border-b last:border-none
                       hover:bg-slate-50 transition"
              >
                <td class="py-3 font-medium text-slate-700">
                  {{ plan.planName }}
                </td>

                <td class="py-3 font-semibold text-orange-500">
                  â‚¹ {{ plan.revenue | number }}
                </td>

                <td class="py-3 text-slate-600">
                  {{ plan.usage }}
                </td>
              </tr>
            }
          </tbody>

        </table>
      </div>
    }

  </div>

  <!-- ============================= -->
  <!-- ðŸ§¾ RECENT TRANSACTIONS -->
  <!-- ============================= -->
  <div class="bg-white rounded-2xl p-6 shadow border mb-20">

    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold text-slate-800">
        Recent Transactions
      </h2>

      <a
        routerLink="/recentTransactions"
        class="text-sm text-blue-600 hover:text-blue-700
               font-medium flex items-center gap-1"
      >
        View All
        <fa-icon [icon]="icons.arrowRight"></fa-icon>
      </a>
    </div>

    @if (transactions.length === 0) {
      <div class="text-center py-8 text-slate-500 text-sm">
        No recent transactions available
      </div>
    }

    @if (transactions.length > 0) {
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">

          <thead>
            <tr class="text-left text-slate-500 border-b">
              <th class="py-3">User</th>
              <th class="py-3">Amount</th>
              <th class="py-3">Status</th>
              <th class="py-3">Date</th>
            </tr>
          </thead>

          <tbody>
            @for (txn of transactions; track txn.paymentId) {
              <tr
                class="border-b last:border-none
                       hover:bg-slate-50 transition"
              >
                <td class="py-3 font-medium text-slate-700">
                  {{ txn.userName }}
                </td>

                <td class="py-3 font-semibold text-orange-500">
                  â‚¹ {{ txn.paidPrice | number }}
                </td>

                <td class="py-3">
                  <span
                    class="px-2 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-green-100 text-green-700':
                        txn.paymentStatus.toUpperCase() === 'SUCCESS',
                      'bg-yellow-100 text-yellow-700':
                        txn.paymentStatus.toUpperCase() === 'PENDING',
                      'bg-blue-100 text-blue-700':
                        txn.paymentStatus.toUpperCase() === 'REFUNDED',
                      'bg-red-100 text-red-700':
                        txn.paymentStatus.toUpperCase() !== 'SUCCESS'
                        && txn.paymentStatus.toUpperCase() !== 'PENDING'
                        && txn.paymentStatus.toUpperCase() !== 'REFUNDED'
                    }"
                  >
                    {{ txn.paymentStatus }}
                  </span>
                </td>

                <td class="py-3 text-slate-600">
                  {{ txn.paymentDate | date:'mediumDate' }}
                </td>
              </tr>
            }
          </tbody>

        </table>
      </div>
    }

  </div>

  <!-- ============================= -->
  <!-- â¬†ï¸ MOVE TO TOP -->
  <!-- ============================= -->
  <button
    (click)="scrollToTop()"
    class="fixed bottom-6 right-6
           bg-orange-500 hover:bg-orange-600
           text-white w-12 h-12 rounded-full
           shadow-lg transition"
  >
    <fa-icon [icon]="icons.arrowUp"></fa-icon>
  </button>

</div>
