<!-- PROFILE + SIDE CARDS WRAPPER -->
<div class="w-full flex flex-col xl:flex-row gap-8 justify-center">
  <!-- ==========================
       PROFILE MAIN CARD
       ========================== -->
  <div
    class="w-full max-w-5xl mx-auto p-8 rounded-3xl shadow-2xl flex flex-col md:flex-row items-center gap-10 bg-linear-to-br from-[#242424]/80 via-[#1e1e1e]/70 to-[#111]/80 backdrop-blur-xl border border-gray-700 text-white transition-all duration-500 hover:shadow-orange-400/40"
  >
    <!-- PROFILE IMAGE -->
    <div class="relative group shrink-0">
      <div
        class="w-48 h-48 sm:w-56 sm:h-56 md:w-64 md:h-64 rounded-2xl border-4 border-orange-500 shadow-lg overflow-hidden transition-transform duration-500 group-hover:scale-105 group-hover:shadow-orange-400/40"
      >
        <div
          class="w-full h-full bg-center bg-cover bg-no-repeat"
          [ngStyle]="{ 'background-image': 'url(' + profileImage + ')' }"
        ></div>
      </div>

      <!-- Upload + Delete Buttons -->
      <div
        class="absolute bottom-3 right-3 flex gap-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300"
      >
        <input
          type="file"
          accept="image/*"
          #fileInput
          class="hidden"
          (change)="onFileSelected($event)"
        />

        <button
          (click)="fileInput.click()"
          class="bg-blue-500 hover:bg-blue-600 p-2 rounded-full shadow-md hover:scale-110 transition"
          title="Upload new image"
        >
          <fa-icon [icon]="icons.camera" class="text-white text-lg"></fa-icon>
        </button>

        <button
          (click)="deleteImage()"
          [disabled]="!canDelete"
          class="p-2 rounded-full shadow-md transition bg-red-500 hover:bg-red-600 hover:scale-110 disabled:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:scale-100"
        >
          <fa-icon [icon]="icons.trash" class="text-white text-lg"></fa-icon>
        </button>
      </div>
    </div>

    <!-- PROFILE DETAILS -->
    <div class="flex-1 text-gray-200 space-y-4">
      <h2 class="text-3xl font-bold">Hello,</h2>

      <h2 class="text-3xl font-bold tracking-wide">
        <span class="text-orange-400">{{ trainerDetail.firstName }}</span>
        <span class="text-blue-400">{{ trainerDetail.lastName }}</span>
      </h2>

      <!-- Trainer ID -->
      <p class="tracking-wide text-sm">
        <strong><fa-icon [icon]="icons.id"></fa-icon></strong>

        <span class="text-blue-500">{{ trainerId.substring(0, 2) }}</span>
        <span class="text-orange-500">{{ trainerId.substring(2, 3) }}</span>
        <span class="text-yellow-400">{{ trainerId.substring(3, 6) }}</span>
        <span>{{ trainerId.substring(6, 7) }}</span>
        <span class="text-green-400">{{ trainerId.substring(7, 9) }}</span>
        <span>{{ trainerId.substring(9) }}</span>
      </p>

      <!-- Basic Info -->
      <p>
        <fa-icon [icon]="icons.user" class="text-indigo-400"></fa-icon>
        {{ trainerDetail.firstName }} {{ trainerDetail.lastName }}
      </p>
      <p>
        <fa-icon [icon]="icons.mail" class="text-green-400"></fa-icon>
        {{ trainerDetail.emailId }}
      </p>
      <p>
        <fa-icon [icon]="icons.phone" class="text-yellow-400"></fa-icon>
        {{ trainerDetail.phone }}
      </p>

      <!-- Gender -->
      <p class="flex items-center gap-2">
        <fa-icon [icon]="genderIcon" class="text-pink-400"></fa-icon>
        {{ trainerDetail.gender.toUpperCase() }}
      </p>

      <!-- ==========================
                SPECIALITIES SECTION
                ========================== -->
      <div class="pt-4 space-y-4">
        <h3 class="text-lg font-semibold">Specialities</h3>

        <div class="flex flex-wrap gap-3 w-full">
          <!-- Speciality Chips -->
          @for (sp of trainerSpecialities; track sp) {
          <div
            class="flex items-center gap-2 bg-blue-600 text-white px-4 py-1 rounded-full text-sm shadow-sm animate-scaleIn"
          >
            <span>{{ sp.replace("_", " ") }}</span>

            <button
              (click)="confirmRemoveSpeciality(sp)"
              class="p-1 rounded-full hover:bg-white/20 transition"
            >
              <fa-icon [icon]="icons.close"></fa-icon>
            </button>
            
          </div>
          }

          <!-- If empty -->
          @if (trainerSpecialities.length === 0) {
          <p class="text-gray-400 text-sm">No specialities added.</p>
          }

          <!-- Add Button -->
          <div class="relative group inline-block">
            <!-- BUTTON -->
            <button
              (click)="openAddSpecialityPopup()"
              [disabled]="trainerSpecialities.length >= 5"
              class="w-10 h-10 flex justify-center items-center rounded-full border transition border-gray-600 hover:bg-black/40 hover:scale-110 disabled:cursor-not-allowed disabled:opacity-40 disabled:hover:scale-100 disabled:hover:bg-transparent"
            >
              <fa-icon
                [icon]="icons.plus"
                class="text-orange-400 text-lg transition group-disabled:text-gray-500"
              >
              </fa-icon>
            </button>

            <!-- TOOLTIP -->
            @if (trainerSpecialities.length >= 5) {
            <div
              class="absolute left-1/2 -translate-x-1/2 mt-2 px-3 py-1 rounded bg-black/80 text-white text-xs opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap z-50"
            >
              You can add a maximum of 5 specialities
            </div>
            }
          </div>
        </div>

        <!-- STATUS -->
        <div class="flex items-center gap-4 mt-2">
          <span
            class="px-3 py-1 rounded-full text-xs font-semibold"
            [ngClass]="{
              'bg-green-600 text-white': trainerStatus === 'AVAILABLE',
              'bg-red-600 text-white': trainerStatus === 'UNAVAILABLE',
              'bg-yellow-500 text-black': trainerStatus === 'BUSY'
            }"
          >
            {{ trainerStatus }}
          </span>

          <select
            [(ngModel)]="trainerStatus"
            class="bg-black/40 border border-gray-600 rounded px-3 py-1 text-sm text-gray-200"
            (ngModelChange)="updateStaus()"
          >
            <option value="AVAILABLE">Available</option>
            <option value="UNAVAILABLE">Unavailable</option>
            <option value="BUSY">Busy</option>
          </select>
        </div>
      </div>
    </div>

        <!-- ==========================
     LIVE STATS (CLEAN FLOATING STYLE)
========================== -->
    <div class="w-full md:w-auto grid gap-5">
      <!-- Active Members -->
      <div
        class="flex items-center justify-between border-t-2 border-gray-600 pt-3 pb-3"
      >
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 rounded-full bg-orange-600 shadow-md"></div>
          <fa-icon
            [icon]="icons.member"
            class="text-xl text-orange-400"
          ></fa-icon>
          <span class="font-medium text-gray-300">Active Members:</span>
        </div>
        <span class="text-2xl font-extrabold text-orange-300">{{
          liveMemberCount
        }}</span>
      </div>

      <!-- Active Trainers -->
      <div
        class="flex items-center justify-between border-t-2 border-gray-600 pt-3 pb-3"
      >
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 rounded-full bg-blue-600 shadow-md"></div>
          <fa-icon
            [icon]="icons.trainer"
            class="text-xl text-blue-400"
          ></fa-icon>
          <span class="font-medium text-gray-300">Active Trainers:</span>
        </div>
        <span class="text-2xl font-extrabold text-blue-300">{{
          liveTrainerCount
        }}</span>
      </div>

      <!-- Active Admins -->
      <div
        class="flex items-center justify-between border-t-2 border-gray-600 pt-3"
      >
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 rounded-full bg-yellow-600 shadow-md"></div>
          <fa-icon
            [icon]="icons.admined"
            class="text-xl text-yellow-400"
          ></fa-icon>
          <span class="font-medium text-gray-300">Active Admins:</span>
        </div>
        <span class="text-2xl font-extrabold text-yellow-300">{{
          liveAdminCount
        }}</span>
      </div>
    </div>
  </div>

  <!-- ==========================
       ABOUT CARD ON RIGHT SIDE
       ========================== -->
  <div class="w-full xl:w-80 flex flex-col">
    <div
      class="w-full p-6 rounded-2xl bg-[#1e1e1e]/70 backdrop-blur-lg border border-gray-700 shadow-xl text-slate-200 hover:shadow-orange-400/30 transition-all duration-300 h-full"
    >
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold">About Me</h3>

        <button
          (click)="openAboutPopup()"
          class="p-2 rounded-lg bg-gray-800 hover:bg-gray-700 transition hover:scale-110"
        >
          <fa-icon [icon]="icons.edit" class="text-orange-400"></fa-icon>
        </button>
      </div>

      <p class="text-slate-300 text-sm leading-relaxed wrap-break-word">
        {{ aboutTrainer || "No information added yet." }}
      </p>
    </div>
  </div>
</div>

<!-- ========================= -->
<!-- ABOUT POPUP              -->
<!-- ========================= -->
@if (aboutPopup) {
<div
  class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn"
>
  <div
    class="bg-gray-900 border border-gray-700 rounded-xl p-6 w-full max-w-lg space-y-4 animate-popupScale"
  >
    <h2 class="text-xl font-bold text-white">Edit About Info</h2>

    <!-- BIGGER TEXT AREA + COUNTER -->
    <div class="space-y-2">
      <textarea
        [(ngModel)]="aboutTrainer"
        (input)="updateCharCount()"
        maxlength="300"
        class="w-full p-3 rounded-lg bg-black/40 border border-gray-600 text-gray-200 min-h-[180px] resize-none"
        placeholder="Write something about yourself... (10 - 300 characters)"
      >
      </textarea>

      <!-- CHARACTER COUNTER -->
      <p
        class="text-right text-sm"
        [class.text-red-400]="aboutCharCount > 300"
        [class.text-gray-400]="aboutCharCount <= 300"
      >
        {{ aboutCharCount }}/300 characters
      </p>
    </div>

    <div class="flex justify-end gap-3">
      <button
        (click)="closeAboutPopup()"
        class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition"
      >
        Cancel
      </button>

      <button
        (click)="saveAboutInfo()"
        [disabled]="aboutCharCount < 10 || aboutCharCount > 300"
        class="px-4 py-2 rounded-lg transition bg-orange-500 hover:bg-orange-600 disabled:bg-gray-600 disabled:cursor-not-allowed"
      >
        Save
      </button>
    </div>
  </div>
</div>
}

<!-- ========================= -->
<!-- ADD SPECIALITY POPUP     -->
<!-- ========================= -->
@if (addSpecialityPopup) {
<div
  class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn"
>
  <div
    class="bg-gray-900 border border-gray-700 rounded-xl p-6 w-full max-w-md space-y-4 animate-popupScale"
  >
    <h2 class="text-xl font-bold text-white">Add Speciality</h2>

    <!-- SEARCH BOX -->
    <input
      [(ngModel)]="searchText"
      class="w-full p-3 rounded-lg bg-black/40 border border-gray-600 text-gray-200"
      placeholder="Search speciality..."
    />

    <!-- SUGGESTION LIST -->
    <div
      class="max-h-64 overflow-y-auto mt-2 rounded-lg border border-gray-700 bg-black/30"
    >
      @for (sp of specialities |serarchPipe : searchText; track sp) {
      <div
        (click)="selectSpeciality(sp)"
        class="p-3 hover:bg-blue-600/40 cursor-pointer transition flex justify-between items-center"
      >
        <span class="text-gray-200">{{ sp }}</span>

        <fa-icon [icon]="icons.plus" class="text-blue-400"></fa-icon>
      </div>
      } @if ((specialities | serarchPipe: searchText).length === 0) {
      <p class="text-gray-500 text-center p-4">No matches found.</p>
      }
    </div>

    <!-- BUTTONS -->
    <div class="flex justify-end gap-3 mt-4">
      <button
        (click)="closeAddSpecialityPopup()"
        class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition"
      >
        Cancel
      </button>

      <button
        (click)="saveSpeciality()"
        class="px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition"
      >
        Add
      </button>
    </div>
  </div>
</div>
}
