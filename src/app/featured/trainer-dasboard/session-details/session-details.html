<div
  class="w-full p-6 rounded-3xl bg-linear-to-br from-[#242424]/80 via-[#1e1e1e]/70 to-[#111]/80
         border border-gray-700 shadow-xl backdrop-blur-xl text-gray-100
         transition-all duration-500 hover:shadow-orange-400/30 animate-fadeInSlow"
>

  <!-- HEADER -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h2 class="text-2xl font-bold text-white">Sessions</h2>
      <p class="text-sm text-gray-300">Your training sessions overview</p>
    </div>

    <fa-icon [icon]="icons.calendar" class="text-3xl text-orange-400"></fa-icon>
  </div>

  <!-- VIEW TOGGLE -->
  <div class="flex gap-4 mb-6">
    <button
      class="px-4 py-2 text-sm rounded-xl transition-all duration-300"
      [ngClass]="upcomingView
        ? 'bg-blue-600/30 border border-blue-500/40 text-blue-300'
        : 'bg-black/20 border border-gray-600 text-gray-300 hover:text-white'"
      (click)="upcomingView = true; loadAllUpcomingSession()"
    >
      Upcoming
    </button>

    <button
      class="px-4 py-2 text-sm rounded-xl transition-all duration-300"
      [ngClass]="!upcomingView
        ? 'bg-blue-600/30 border border-blue-500/40 text-blue-300'
        : 'bg-black/20 border border-gray-600 text-gray-300 hover:text-white'"
      (click)="upcomingView = false; loadAllPastSessions()"
    >
      Past
    </button>
  </div>

  <!-- SCROLL AREA -->
  <div class="overflow-x-auto max-h-[460px] sessions-scroll">
    
    <table class="w-full text-left border-separate border-spacing-y-4">
      <thead>
        <tr class="text-gray-300 text-sm">
          <th class="pb-2">Session</th>
          <th class="pb-2">Time</th>
          <th class="pb-2">Status</th>
          <th class="pb-2 text-center">Actions</th>
        </tr>
      </thead>

      <tbody>

        <!-- ============================== -->
        <!--         UPCOMING VIEW          -->
        <!-- ============================== -->
        @if (upcomingView) {

          @if (USSessions.length === 0) {
            <tr>
              <td colspan="4" class="text-center py-10 text-gray-400">No upcoming sessions</td>
            </tr>
          }

          @for (s of USSessions; track s.sessionId) {

            <tr
              class="bg-[#1b1b1b]/70 hover:bg-[#262626]/80 transition-all duration-300 
                     rounded-xl shadow-lg hover:shadow-blue-400/20"
            >

              <!-- SESSION NAME -->
              <td class="py-4 pl-3 text-gray-100 font-semibold">
                {{ s.sessionName }}
              </td>

              <!-- TIME RANGE -->
              <td class="py-4 text-gray-300 text-sm">
                <div>{{ mapDate(s.sessionStartTime.toString()) }}</div>
                <div class="text-xs mt-0.5 text-gray-400">
                  → {{ mapDate(s.sessionEndTime.toString()) }}
                </div>
              </td>

              <!-- STATUS -->
              <td class="py-4">
                <span
                  class="px-3 py-1 rounded-full text-xs font-semibold border"
                  [ngClass]="{
                    'bg-green-600/30 text-green-300 border-green-500/40': s.sessionStatus === 'UPCOMING',
                    'bg-yellow-600/30 text-yellow-300 border-yellow-500/40': s.sessionStatus === 'ONGOING'
                  }"
                >
                  {{ s.sessionStatus }}
                </span>
              </td>

              <!-- ACTION BUTTONS -->
              <td class="py-4 text-center">
                <div class="flex justify-center gap-3">

                  <!-- EDIT -->
                  <button
                    (click)="openUpdateSessionPopup(s)"
                    class="px-3 py-2 rounded-full bg-blue-600/30 border border-blue-500/40
                           hover:bg-blue-600 hover:border-blue-400 hover:scale-110 transition">
                    <fa-icon [icon]="icons.edit"></fa-icon>
                  </button>

                  <!-- DELETE -->
                  <button
  (click)="openDeletePopup(s.sessionId)"
  class="px-3 py-2 rounded-full bg-red-600/30 border border-red-500/40 hover:bg-red-600">
  <fa-icon [icon]="icons.trash"></fa-icon>
</button>

                  <!-- UPDATE STATUS -->
                  <button
                    (click)="openStatusPopup(s.sessionId)"
                    class="px-3 py-2 rounded-full bg-yellow-600/30 border border-yellow-500/40
                           hover:bg-yellow-600 hover:border-yellow-400 hover:scale-110 transition">
                    <fa-icon [icon]="icons.flag"></fa-icon>
                  </button>

                </div>
              </td>

            </tr>

          }

        }

        <!-- ============================== -->
        <!--            PAST VIEW           -->
        <!-- ============================== -->
        @else {

          @if (PsSessions.length === 0) {
            <tr>
              <td colspan="4" class="text-center py-10 text-gray-400">No past sessions</td>
            </tr>
          }

          @for (s of PsSessions; track s.sessionId) {

            <tr
              class="bg-[#1b1b1b]/70 hover:bg-[#262626]/80 transition-all duration-300 
                     rounded-xl shadow-lg hover:shadow-red-400/20"
            >

              <!-- SESSION NAME -->
              <td class="py-4 pl-3 text-gray-100 font-semibold">
                {{ s.sessionName }}
              </td>

              <!-- TIME RANGE -->
              <td class="py-4 text-gray-300 text-sm">
                <div>{{ mapDate(s.sessionStartTime.toString()) }}</div>
                <div class="text-xs mt-0.5 text-gray-400">
                  → {{ mapDate(s.sessionEndTime.toString()) }}
                </div>
              </td>

              <!-- STATUS (ALWAYS COMPLETED / MISSED) -->
              <td class="py-4">
                <span
                  class="px-3 py-1 rounded-full text-xs font-semibold bg-red-600/30 text-red-300 border border-red-500/40">
                  {{ s.sessionStatus }}
                </span>
              </td>

              <!-- ACTION BUTTON (PAST ONLY) -->
              <td class="py-4 text-center">
                <button
                  (click)="openStatusPopup(s.sessionId)"
                  class="px-4 py-2 rounded-xl bg-blue-600/30 text-blue-300 border border-blue-500/40
                         hover:bg-blue-600 hover:border-blue-400 hover:scale-105 transition">
                  Set Status
                </button>
              </td>

            </tr>

          }

        }

      </tbody>
    </table>

  </div>

  <!-- PAGINATION -->
  <div class="flex justify-between mt-4 pt-2">
    
    <button
      class="px-4 py-2 rounded-xl bg-black/30 border border-gray-700 hover:bg-black/40 transition disabled:opacity-40"
      [disabled]="upcomingView ? USPageNo === 0 : PsPageNo === 0"
      (click)="upcomingView ? loadPreviousUpcomingSessions() : loadPreviousPastSessions()"
    >
      Previous
    </button>

    <button
      class="px-4 py-2 rounded-xl bg-black/30 border border-gray-700 hover:bg-black/40 transition disabled:opacity-40"
      [disabled]="upcomingView ? USlastPage : PslastPage"
      (click)="upcomingView ? loadNextUpCommingSessions() : loadNextPastSessions()"
    >
      Next
    </button>

  </div>

</div>
@if (updateSessionView) {
<div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-center animate-fadeIn">

  <div class="bg-[#1a1a1a] w-full max-w-lg p-6 rounded-2xl border border-gray-700 shadow-xl animate-softPop">

    <h2 class="text-xl font-bold text-white mb-4">Update Session</h2>

    <!-- SESSION NAME -->
    <div class="mb-4">
      <label class="text-sm text-gray-300">Session Name</label>
      <input
        [(ngModel)]="updateSessionForm.sessionName"
        class="w-full p-3 bg-black/30 border border-gray-600 rounded-xl text-gray-200 outline-none 
               focus:border-orange-400 transition"
        placeholder="e.g., HIIT Training"
      />
    </div>

    <!-- DATE & TIME -->
    <div class="mb-4">
      <label class="text-sm text-gray-300">Session Date & Time</label>
      <input
        type="datetime-local"
        [(ngModel)]="updateSessionForm.sessionDate"
        class="w-full p-3 bg-black/30 border border-gray-600 rounded-xl text-gray-200 outline-none 
               focus:border-orange-400 transition"
      />
    </div>

    <!-- DURATION -->
    <div class="mb-4">
      <label class="text-sm text-gray-300">Duration (hours)</label>
      <input
        type="number"
        step="0.5"
        min="0.5"
        max="2.5"
        [(ngModel)]="updateSessionForm.duration"
        class="w-full p-3 bg-black/30 border border-gray-600 rounded-xl text-gray-200 outline-none 
               focus:border-orange-400 transition"
      />
    </div>

    <!-- BUTTONS -->
    <div class="flex justify-end gap-3 mt-6">
      <button
        class="px-4 py-2 rounded-xl bg-gray-700 hover:bg-gray-600 transition"
        (click)="closeUpdateSessionPopup()">
        Cancel
      </button>

      <button
        class="px-4 py-2 rounded-xl bg-blue-600 hover:bg-blue-700 transition disabled:bg-gray-600 disabled:cursor-not-allowed"
        [disabled]="!isFormValid()"
        (click)="updateSession()">
        Save Changes
      </button>
    </div>

  </div>
</div>
}
@if (deletePopup) {
<div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex justify-center items-center animate-fadeIn">

  <div class="bg-[#1a1a1a] w-full max-w-sm p-6 rounded-2xl border border-gray-700 text-center shadow-xl animate-softPop">

    <h2 class="text-xl font-bold text-white mb-3">Delete Session?</h2>
    <p class="text-gray-300 text-sm mb-6">
      Are you sure you want to delete this session?  
      This action cannot be undone.
    </p>

    <div class="flex justify-center gap-4">
      <button
        class="px-4 py-2 rounded-xl bg-gray-700 hover:bg-gray-600 transition"
        (click)="closeDeletePopUp()">
        Cancel
      </button>

      <button
        class="px-4 py-2 rounded-xl bg-red-600 hover:bg-red-700 transition"
        (click)="confirmDeleteSession()">
        Delete
      </button>
    </div>

  </div>
</div>
}
@if (statusPopupVisible) {

<div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center animate-fadeIn">

  <div
    class="bg-[#1c1c1c]/90 w-full max-w-md p-6 rounded-2xl border border-gray-700
           shadow-2xl animate-softPop text-gray-200"
  >

    <h2 class="text-xl font-semibold text-white mb-5 flex items-center gap-2">
      <fa-icon [icon]="icons.calendar"></fa-icon>
      Update Session Status
    </h2>

    <!-- STATUS SELECT -->
    <div>
      <label class="text-sm text-gray-300">Select New Status</label>

      <select
        [(ngModel)]="updateSessionStatus"
        class="w-full mt-2 p-3 rounded-xl bg-black/30 border border-gray-600
               text-gray-200 focus:border-orange-400 outline-none transition"
      >

        <!-- Recommended FAANG statuses -->
        <option value="" disabled>Select Status</option>

        <option value="UPCOMING">Upcoming</option>
        <option value="ONGOING">Ongoing</option>
        <option value="COMPLETED">Completed</option>
        <option value="CANCELLED">Cancelled</option>

      </select>

      <!-- VALIDATION -->
      @if (!updateSessionStatus || updateSessionStatus.trim().length === 0) {
        <p class="text-red-400 text-xs mt-1">* Status must not be empty</p>
      }
    </div>

    <!-- BUTTONS -->
    <div class="flex justify-end gap-3 mt-6">

      <button
        class="px-4 py-2 rounded-xl bg-gray-700 hover:bg-gray-600 transition"
        (click)="closeStatusPopup()"
      >
        Cancel
      </button>

      <button
        class="px-4 py-2 rounded-xl bg-blue-600 hover:bg-blue-700 transition
               disabled:bg-gray-600 disabled:cursor-not-allowed"
        [disabled]="!updateSessionStatus"
        (click)="submitStatusUpdate()"
      >
        Update
      </button>

    </div>

  </div>
</div>

}
