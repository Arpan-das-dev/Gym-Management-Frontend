@if (clients && clients.length > 0) {

<div class="card-wrapper h-full flex flex-col">

  <div
    class="flex-1 w-full p-6 rounded-3xl 
           bg-linear-to-br from-[#242424]/80 via-[#1e1e1e]/70 to-[#111]/80
           border border-gray-700 shadow-xl backdrop-blur-xl text-gray-100
           transition-all duration-500 hover:shadow-orange-400/30 animate-fadeInSlow"
  >

    <!-- HEADER -->
    <div class="header flex justify-between items-center mb-6">
      <div>
        <h2 class="text-2xl font-bold text-white">Active Clients</h2>
        <p class="text-sm text-gray-300">Clients currently assigned to you</p>
      </div>

      <fa-icon [icon]="icons.users" class="text-3xl text-orange-400"></fa-icon>
    </div>

    <!-- TABLE WRAPPER (scrollable) -->
    <div class="content flex-1 overflow-y-auto min-h-0">
      <table class="w-full text-left border-separate border-spacing-y-4">
        <thead>
          <tr class="text-gray-300 text-sm">
            <th class="pb-2">Client</th>
            <th class="pb-2">Eligibility</th>
            <th class="pb-2 text-center">Add Session</th>
          </tr>
        </thead>

        <tbody>
          @for (c of clients; track c.memberId) {

          <tr
            class="bg-[#1b1b1b]/70 hover:bg-[#262626]/80 transition-all duration-300
                   rounded-xl shadow-lg hover:shadow-blue-400/20"
          >

            <!-- CLIENT PROFILE -->
            <td class="py-4 pl-3 flex items-center gap-4">
              
              <div class="relative">
                <div class="w-12 h-12 rounded-full overflow-hidden border border-gray-700">
                  <div class="w-full h-full bg-cover bg-center"
                      [ngStyle]="{ 'background-image': 'url(' + c.memberProfileImageUrl + ')' }"></div>
                </div>

                <!-- STATUS DOT -->
                <div class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border border-black shadow-md"
                     [ngClass]="{
                       'bg-green-500': isActive(c.memberId),
                       'bg-gray-500': !isActive(c.memberId)
                     }"></div>
              </div>

              <div class="flex flex-col">
                <span class="font-semibold text-gray-100">{{ c.memberName }}</span>
                <span class="text-xs text-gray-400">ID: {{ c.memberId }}</span>
              </div>

            </td>

            <!-- ELIGIBILITY -->
            <td class="py-4 text-gray-200 text-sm">
              <span class="text-yellow-400">{{ c.eligibilityEnd | date: 'dd MMM yyyy' }}</span>
            </td>

            <!-- ADD SESSION -->
            <td class="py-4 text-center">
              <button
                (click)="openAddSessionPopup(c)"
                class="px-3 py-2 rounded-full bg-blue-600/40 border border-blue-500/40
                       hover:bg-blue-600 hover:border-blue-400 hover:scale-110 transition shadow-md"
              >
                <fa-icon [icon]="icons.plus" class="text-blue-300 text-lg"></fa-icon>
              </button>
            </td>

          </tr>

          }
        </tbody>
      </table>
    </div>

  </div>

</div>

} @else {

<!-- EMPTY CARD STILL WRAPPED -->
<div class="card-wrapper h-full flex flex-col">

  <div class="flex-1 w-full p-8 rounded-3xl bg-[#1e1e1e]/70 border border-gray-700
              shadow-xl backdrop-blur-xl text-center text-gray-300 animate-fadeInSlow">

    <fa-icon [icon]="icons.userSlash" class="text-4xl text-gray-500 mb-3"></fa-icon>
    <p class="text-lg">No active clients found.</p>

  </div>

</div>

}

<!-- ADD SESSION POPUP -->
@if (addSessionPopup) {

<div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center animate-fadeIn">
  <div class="bg-[#1c1c1c]/90 w-full max-w-lg p-6 rounded-2xl border border-gray-700 shadow-2xl animate-softPop text-gray-200">

    <h2 class="text-xl font-semibold text-white mb-5 flex items-center gap-2">
      <fa-icon [icon]="icons.plus" class="text-orange-400"></fa-icon>
      Add Training Session
    </h2>

    <!-- Session Name -->
    <div class="mb-4">
      <label class="text-sm text-gray-300">Session Name</label>
      <input [(ngModel)]="sessionForm.sessionName"
             class="w-full mt-1 p-3 rounded-xl bg-black/30 border border-gray-600 text-gray-200 outline-none focus:border-orange-400"/>
      @if (!sessionForm.sessionName) {
        <p class="text-red-400 text-xs mt-1">* Session name must not be blank</p>
      }
    </div>

    <!-- Date -->
    <div class="mb-4">
      <label class="text-sm text-gray-300">Session Date & Time</label>
      <input type="datetime-local" [(ngModel)]="sessionForm.sessionDate"
             class="w-full mt-1 p-3 rounded-xl bg-black/30 border border-gray-600 text-gray-200 outline-none focus:border-orange-400"/>

      @if (!sessionForm.sessionDate) { <p class="text-red-400 text-xs mt-1">* Session date required</p> }
      @if (sessionForm.sessionDate && isPastDate(sessionForm.sessionDate)) {
        <p class="text-red-400 text-xs mt-1">* Date must be in the future</p>
      }
    </div>

    <!-- Duration -->
    <div class="mb-4">
      <label class="text-sm text-gray-300">Duration (hours)</label>
      <input type="number" min="0.5" max="2.5" step="0.5"
             [(ngModel)]="sessionForm.duration"
             class="w-full mt-1 p-3 rounded-xl bg-black/30 border border-gray-600 text-gray-200 outline-none focus:border-orange-400"/>

      @if (!sessionForm.duration) { <p class="text-red-400 text-xs mt-1">* Duration required</p> }
      @if (sessionForm.duration < 0.5) { <p class="text-red-400 text-xs mt-1">* Minimum is 0.5</p> }
      @if (sessionForm.duration > 2.5) { <p class="text-red-400 text-xs mt-1">* Maximum is 2.5</p> }
    </div>

    <!-- Buttons -->
    <div class="flex justify-end gap-3 mt-6">
      <button class="px-4 py-2 rounded-xl bg-gray-700 hover:bg-gray-600" (click)="closeAddSessionPopup()">Cancel</button>
      <button [disabled]="!isFormValid()" class="px-4 py-2 rounded-xl bg-orange-500 hover:bg-orange-600 disabled:bg-gray-600"
              (click)="submitSession()">Add Session</button>
    </div>

  </div>
</div>

}
