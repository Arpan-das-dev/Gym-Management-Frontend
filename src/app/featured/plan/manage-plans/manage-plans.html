
<!-- Full-Screen Loading Overlay -->
@if (loading) {
  <div class="fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-50">
    <div class="text-center animate-pulse text-white">
      <fa-icon [icon]="icons.cogs" class="text-6xl mb-3"></fa-icon>
      <p class="text-lg font-semibold tracking-wide">Processing...</p>
    </div>
  </div>
}

<!-- Coupon Popup -->
@if (showCouponPopup) {
  <div class="fixed inset-0 flex items-center justify-center bg-black/50 z-40">
    <div class="bg-white p-6 rounded-2xl shadow-xl w-96">
      <h3 class="text-xl font-bold mb-4 text-gray-800">Launch Coupon</h3>
      <div class="space-y-3">
        <input type="text" placeholder="Coupon Code (e.g., FIT50)" [(ngModel)]="cuponCode.cuponCode"
               class="w-full border px-3 py-2 rounded-lg uppercase"/>
        <input type="number" placeholder="Offer %" [(ngModel)]="cuponCode.offPercentage"
               class="w-full border px-3 py-2 rounded-lg"/>
        <input type="date" [(ngModel)]="cuponCode.validity" class="w-full border px-3 py-2 rounded-lg"/>
      </div>
      <div class="flex justify-end gap-3 mt-4">
        <button class="px-4 py-2 bg-gray-300 rounded-lg" (click)="closeCouponPopup()">Cancel</button>
        <button class="px-4 py-2 bg-orange-500 text-white rounded-lg" (click)="launchCoupon()">Launch</button>
      </div>
    </div>
  </div>
}

<!-- Delete Confirmation Popup -->
@if (showDeletePopup) {
  <div class="fixed inset-0 flex items-center justify-center bg-black/50 z-40">
    <div class="bg-white p-6 rounded-2xl shadow-xl w-80 text-center">
      <fa-icon [icon]="icons.trash" class="text-red-500 text-3xl mb-3"></fa-icon>
      <p class="font-semibold text-gray-800 mb-4">Are you sure you want to delete this plan?</p>
      <div class="flex justify-center gap-3">
        <button class="px-4 py-2 bg-gray-300 rounded-lg" (click)="closeDeletePopup()">No</button>
        <button class="px-4 py-2 bg-red-500 text-white rounded-lg" (click)="confirmDelete()">Yes</button>
      </div>
    </div>
  </div>
}

<!-- Main Section -->
<div class="min-h-screen bg-cover bg-center p-8" style="background-image: url('gymPlanBg.jpg')">
  <div class="text-center mb-10">
    <h1 class="text-4xl font-extrabold text-white drop-shadow-lg">Manage Subscription Plans</h1>
    <p class="text-gray-200 mt-2 text-lg">Edit, delete or add new subscription plans</p>
  </div>

  <!-- Plans Grid -->
  <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
    @for (plan of plans; track plan.planId) {
      <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-xl hover:shadow-2xl transition">
        <h2 class="text-xl font-bold text-gray-800 mb-2">{{ plan.planName }}</h2>
        <p class="text-orange-600 font-semibold text-2xl mb-3">₹{{ plan.price }}</p>
        <span class="bg-orange-100 text-orange-600 text-sm px-3 py-1 rounded-full mb-4 inline-block">
          Duration: {{ plan.duration }} days
        </span>

        <ul class="space-y-2 mb-4">
          @for (feature of plan.planFeatures; track $index) {
            <li class="flex items-center justify-between text-gray-700 bg-gray-100 px-3 py-1 rounded-lg">
              <span>{{ feature }}</span>
              @if (plan.editMode) {
                <button class="text-red-500 hover:text-red-600" (click)="removeFeature(plan.planId, $index)">
                  <fa-icon [icon]="icons.xmark"></fa-icon>
                </button>
              }
            </li>
          }
        </ul>

        <div class="flex flex-wrap justify-between gap-2">
          @if (!plan.editMode) {
            <button class="btn bg-orange-500 text-white" (click)="toggleEdit(plan)">
              <fa-icon [icon]="icons.edit" class="mr-1"></fa-icon> Update
            </button>
            <button class="btn bg-green-500 text-white" (click)="openCouponPopup(plan.planId)">
              <fa-icon [icon]="icons.ticket"></fa-icon>
            </button>
            <button class="btn bg-red-500 text-white" (click)="openDeletePopup(plan.planId)">
              <fa-icon [icon]="icons.trash"></fa-icon>
            </button>
          } @else {
            <button class="btn bg-green-600 text-white" (click)="savePlan(plan)">
              <fa-icon [icon]="icons.check" class="mr-1"></fa-icon> Save
            </button>
            <button class="btn bg-gray-400 text-white" (click)="cancelEdit(plan)">
              <fa-icon [icon]="icons.xmark"></fa-icon> Cancel
            </button>
          }
        </div>
      </div>
    }

    <!-- Create Plan Card -->
    <div class="flex flex-col items-center justify-center cursor-pointer rounded-2xl bg-linear-to-br from-orange-600 to-orange-400 hover:scale-105 transition p-6 text-white"
         (click)="navigateToCreatePlan()">
      <fa-icon [icon]="icons.plusCircle" class="text-5xl mb-3 animate-pulse"></fa-icon>
      <h3 class="text-lg font-semibold">Create New Plan</h3>
    </div>
  </div>

  <!-- Dashboard Button -->
  <div class="flex justify-center mt-10">
    <button class="px-6 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700" (click)="moveToDashboard()">
      ← Back to Dashboard
    </button>
  </div>
</div>
